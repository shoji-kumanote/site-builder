# 設定

## 実行時設定

実行時設定はコマンドラインオプションで指定します。

| オプション名 | 用途                                             | 省略時                                       |
| ------------ | ------------------------------------------------ | -------------------------------------------- |
| --config     | 設定ファイルを指定します。複数の指定も可能です。 | builder.config.yml                           |
| --dry-run    | 実際のファイル作成・削除を行わないで実行します。 | 指定なし                                     |
| --dev        | dev モードを有効します。                         | 指定なし / コマンドが watch の場合は指定あり |

### dev モード

開発時など、速度を重視する場合に使用します。
主に最適化処理や整形処理、minify 処理が省かれるようになります。

## 設定ファイル

設定ファイルは yaml で記述します。

| キー     | 値                                 | 用途                               | 省略時           |
| -------- | ---------------------------------- | ---------------------------------- | ---------------- |
| base     | ファイルパス                       | ソースファイルのベースディレクトリ | （省略不可）     |
| dist     | ファイルパス                       | 出力先ディレクトリ                 | （省略不可）     |
| src      | ファイルパス or ファイルパスの配列 | ソースを探すディレクトリ           | base             |
| vendor   | 文字列 or 文字列の配列             | vendor 判定するファイルのパターン  | `**/vendor/**/*` |
| ignore   | 文字列 or 文字列の配列             | 無視するファイルのパターン         | （なし）         |
| disabled | 文字列 or 文字列の配列             | 使用しないフィルタ                 | （なし）         |
| data     | キー・値データ                     | 引き渡しデータ                     | （なし）         |

# コマンド

| コマンド名 | 用途                                                             |
| ---------- | ---------------------------------------------------------------- |
| info       | 設定とファイルの処理内容を表示します。                           |
| clean      | 出力ファイルを削除します。                                       |
| build      | ファイル処理を実施します。                                       |
| watch      | build 実行後、ファイルを監視して変更時にファイル処理を行います。 |

# ファイル種別

まず vendor 判定を行います。
vendor 判定された場合は以下のように分別されます。

| 拡張子    | 種別        |
| --------- | ----------- |
| .css      | vendor-css  |
| .css 以外 | vendor-file |

次にライブラリ判定を行います。
ライブラリ判定は、ファイル名の先頭が`_`かどうかで判定されます。
ライブラリ判定された場合は以下のように分別されます。

| 拡張子              | 種別                                 |
| ------------------- | ------------------------------------ |
| .sass / .scss       | sass-lib                             |
| .hbs / .tpl / .html | hbs-lib                              |
| .mjs                | mjs-lib                              |
| .ts                 | ts-lib                               |
| 上記以外            | （ライブラリ判定を覆して次の判定へ） |

vendor 判定もライブラリ判定もされなかった場合は以下のように分別されます。

| 拡張子        | 種別 |
| ------------- | ---- |
| .css          | css  |
| .sass / .scss | sass |
| .hbs / .tpl   | hbs  |
| .html         | html |
| .js           | js   |
| .mjs          | mjs  |
| .ts           | ts   |
| .jpg / .jpeg  | jpeg |
| .png          | png  |
| .gif          | gif  |
| .svg          | svg  |
| 上記以外      | file |

# ファイル処理

## vendor-css

- tpl 用データ作成

## vendor-file

- そのまま

# 処理詳細

## Handlebars による展開処理

以下のファイルは Handlebars による展開処理 が実行されます。

- 拡張子が `.hbs` または `.tpl`
- ファイル名の先頭が `_` でない

出力時は、拡張子が `.html` に変更されます。

### 定義済み変数

| 変数名       | 値                                               |
| ------------ | ------------------------------------------------ |
| \_\_path\_\_ | ベースディレクトリから見た、ファイルへの相対パス |
| \_\_root\_\_ | ファイルからベースディレクトリへの相対パス       |
| \_\_dev\_\_  | dev モードであれば定義される                     |

### 追加ヘルパー: {{include "パス"}}

- パスで指定したファイルを handlebars として扱い、展開します。

### 追加ヘルパー: {{insert "パス"}}

- パスで指定したファイルをそのまま展開します。

### 追加ヘルパーでのパスの扱い

- 先頭が`/`の場合は、ベースディレクトリからの相対パスとみなされます。
- それ以外は、当該ファイルからの相対パスとみなされます。
- ベースディレクトリ以外を差す相対パスはエラーとなります。
- ファイル名先頭の `_` と拡張子は省略可能です。
- 拡張子が省略された場合、`.hbs`, `.tpl`, `.html` の順で探します。

例: `{{include "foo/bar"}}` が指定された場合は以下の順でファイルを探します。

- ./foo/bar
- ./foo/bar.hbs
- ./foo/bar.tpl
- ./foo/bar.html
- ./foo/\_bar
- ./foo/\_bar.hbs
- ./foo/\_bar.tpl
- ./foo/\_bar.html

### データ

設定ファイルの data で引き渡すデータを指定できます。
相対パスをキーにすることで、特定のファイルに対してデータを与えることが可能です。

```yaml
data:
  foo: FOO
  bar: BAR
  file/to/path.hbs:
    foo: FOO-FOO
    bar: BAR-BAR
```

# その他の設定

いくつかのライブラリが使用する設定ファイルは自動的に参照されます。

| ファイル名      | 用途                                 |
| --------------- | ------------------------------------ |
| .browserslistrc | autoprefixer, @babel/preset-env      |
| .prettierrc     | CSS, JavaScript, HTML のフォーマット |
